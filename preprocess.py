import pandas as pd
import numpy as np
import pathlib

def minSDK(df_nan):
    df = df_nan.copy(deep=True)
    df['.//Min_SDK'] = df['.//Min_SDK'].str.replace('Unknown', '0', regex=False)
    df = df[df['.//Min_SDK'].notna()]
    df['.//Min_SDK'] = df['.//Min_SDK'].astype(int)
    
    return df

def minScreen(df_nan):
    df = df_nan.copy(deep=True)
    df = df[df['.//Min_Screen'].notna()]
    
    #create mapping
    mapping = {'small': 0, 'normal': 1, 'large': 2, 'xlarge': 3}
    
    df['.//Min_Screen'] = df['.//Min_Screen'].replace(mapping)
    
    return df

def minOpenGL(df_nan):
    df = df_nan.copy(deep=True)
    #fill nan with zeroes
    df['.//Min_OpenGL'] = df['.//Min_OpenGL'].fillna(0)
    return df


def NaNCleanup(df_nan):
    df = df_nan.copy(deep=True)
    df = minSDK(df)
    df = minScreen(df)
    df = minOpenGL(df)
    
    df = df.drop(columns=['.//MD5', 
                                     './/Supported_CPU', 
                                     './/Signature', 
                                     './/Developer', 
                                     './/Organization', 
                                     './/Locality', 
                                     './/Country', 
                                     './/State'])
    
    return df




def dropConstantCols(df_const):
    #make deep copy
    df = df_const.copy(deep=True)
    #s
    df = df.drop(columns['android.permission.MMS_SEND_OUTBOX_MSG',
                         'android.permission.BACKUP'])
    
    return df


def getOutlierIndeces(df, col, multiplier = 1.5):
    #get Q1 and Q3
    q1, q3 = df[col].quantile([0.25, 0.75],
                              interpolation='nearest')
    # calculate IQR
    iqr = q3 - q1
    #calulate lower and upper boundaries
    bound_lower = q1 - multiplier*iqr
    bound_upper = q3 + multiplier*iqr
    
    #return indeces of outliers outside the boundaries
    df_outlier = df.copy(deep=True)
    df_outlier = df_outlier[(df_outlier[col]>bound_upper) | (df_outlier[col]>bound_upper)]
    
    return df_outlier.index


    
    